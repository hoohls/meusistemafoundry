<form class="{{cssClass}}" autocomplete="off">
  {{!-- Header da Ficha --}}
  <header class="sheet-header">
    <div class="header-content">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100"/>
      
      <div class="header-fields">
        <div class="name-group">
          <input name="name" type="text" value="{{actor.name}}" placeholder="Nome do Personagem"/>
          <div class="level-xp">
            <label>{{localize 'CLASSES.NIVEL'}}: <span class="nivel">{{system.nivel}}</span></label>
            <div class="xp-bar">
              <div class="xp-progress" style="width: {{porcentagemXP}}%"></div>
              <span class="xp-text">{{system.experiencia.atual}} / {{proximoNivel}} XP</span>
            </div>
          </div>
        </div>

        <div class="identity-group">
          <div class="form-group">
            <label>{{localize 'RACAS.RACA'}}:</label>
            <select name="system.raca.nome">
              <option value="">Selecione...</option>
              <option value="humano" {{#if (eq system.raca.nome "humano")}}selected{{/if}}>{{localize "RACAS.HUMANO"}}</option>
              <option value="elfo" {{#if (eq system.raca.nome "elfo")}}selected{{/if}}>{{localize "RACAS.ELFO"}}</option>
              <option value="anao" {{#if (eq system.raca.nome "anao")}}selected{{/if}}>{{localize "RACAS.ANAO"}}</option>
              <option value="halfling" {{#if (eq system.raca.nome "halfling")}}selected{{/if}}>{{localize "RACAS.HALFLING"}}</option>
              <option value="tiefling" {{#if (eq system.raca.nome "tiefling")}}selected{{/if}}>{{localize "RACAS.TIEFLING"}}</option>
              <option value="goblin" {{#if (eq system.raca.nome "goblin")}}selected{{/if}}>{{localize "RACAS.GOBLIN"}}</option>
            </select>
          </div>

          <div class="form-group">
            <label>{{localize 'CLASSES.CLASSE'}}:</label>
            <select name="system.classe.nome">
              <option value="">Selecione...</option>
              <option value="guerreiro" {{#if (eq system.classe.nome "guerreiro")}}selected{{/if}}>{{localize "CLASSES.GUERREIRO"}}</option>
              <option value="mago" {{#if (eq system.classe.nome "mago")}}selected{{/if}}>{{localize "CLASSES.MAGO"}}</option>
              <option value="ladino" {{#if (eq system.classe.nome "ladino")}}selected{{/if}}>{{localize "CLASSES.LADINO"}}</option>
              <option value="diplomata" {{#if (eq system.classe.nome "diplomata")}}selected{{/if}}>{{localize "CLASSES.DIPLOMATA"}}</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </header>

  {{!-- Abas de Navegação --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="principal">Principal</a>
    <a class="item" data-tab="habilidades">Habilidades</a>
    <a class="item" data-tab="magias">Magias</a>
    <a class="item" data-tab="equipamentos">Equipamentos</a>
    <a class="item" data-tab="detalhes">Detalhes</a>
  </nav>

  {{!-- Conteúdo das Abas --}}
  <section class="sheet-body">
    
    {{!-- Aba Principal --}}
    <div class="tab" data-group="primary" data-tab="principal">
      <div class="principal-content">
        
        {{!-- Atributos --}}
        <div class="atributos-section">
          <h3>{{localize 'ATRIBUTOS.ATRIBUTOS'}}</h3>
          <div class="atributos-grid">
            {{#each system.atributos as |atributo key|}}
            <div class="atributo">
              <label>{{localizeAtributo key}}</label>
              <div class="atributo-value">
                <input type="number" name="system.atributos.{{key}}.valor" value="{{atributo.valor}}" min="3" max="18"/>
                <button type="button" class="rolar-atributo" data-atributo="{{key}}" data-nd="9" title="Rolar teste">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </div>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- Recursos --}}
        <div class="recursos-section">
          <h3>{{localize 'RECURSOS.RECURSOS'}}</h3>
          <div class="recursos-grid">
            
            {{!-- Pontos de Vida --}}
            <div class="recurso pv">
              <label>{{localize 'RECURSOS.PV'}}</label>
              <div class="recurso-bar">
                <div class="bar-background">
                  <div class="bar-fill pv-fill" style="width: {{#if system.recursos.pv.max}}{{math system.recursos.pv.valor '/' system.recursos.pv.max '*' 100}}{{else}}0{{/if}}%"></div>
                  <span class="bar-text">{{system.recursos.pv.valor}} / {{system.recursos.pv.max}}</span>
                </div>
                <div class="recurso-controls">
                  <button type="button" class="ajustar-pv" data-operacao="remover" title="Reduzir PV">-</button>
                  <button type="button" class="ajustar-pv" data-operacao="adicionar" title="Aumentar PV">+</button>
                </div>
              </div>
            </div>

            {{!-- Pontos de Magia --}}
            <div class="recurso pm">
              <label>{{localize 'RECURSOS.PM'}}</label>
              <div class="recurso-bar">
                <div class="bar-background">
                  <div class="bar-fill pm-fill" style="width: {{#if system.recursos.pm.max}}{{math system.recursos.pm.valor '/' system.recursos.pm.max '*' 100}}{{else}}0{{/if}}%"></div>
                  <span class="bar-text">{{system.recursos.pm.valor}} / {{system.recursos.pm.max}}</span>
                </div>
                <div class="recurso-controls">
                  <button type="button" class="ajustar-pm" data-operacao="remover" title="Reduzir PM">-</button>
                  <button type="button" class="ajustar-pm" data-operacao="adicionar" title="Aumentar PM">+</button>
                </div>
              </div>
            </div>

            {{!-- Defesa --}}
            <div class="recurso defesa">
              <label>{{localize 'RECURSOS.DEFESA'}}</label>
              <div class="defesa-value">
                <span class="defesa-total">{{system.recursos.defesa.valor}}</span>
                <small class="defesa-breakdown">(10 + {{system.atributos.acao.valor}} + {{system.recursos.defesa.armadura}} + {{system.recursos.defesa.escudo}})</small>
              </div>
            </div>
          </div>
        </div>

        {{!-- Condições --}}
        <div class="condicoes-section">
          <h3>{{localize 'CONDICOES.CONDICOES'}}</h3>
          <div class="condicoes-grid">
            {{#each system.condicoes as |ativo key|}}
            <div class="condicao {{#if ativo}}ativo{{/if}}">
              <input type="checkbox" name="system.condicoes.{{key}}" {{#if ativo}}checked{{/if}} data-condicao="{{key}}" class="toggle-condicao"/>
              <label>{{localize (concat 'CONDICOES.' (uppercase key))}}</label>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- Ações de Descanso --}}
        <div class="descanso-section">
          <h3>Descanso</h3>
          <div class="descanso-buttons">
            <button type="button" class="descanso-curto">Descanso Curto (+1 PV, +1 PM)</button>
            <button type="button" class="descanso-longo">Descanso Longo (Recuperação Completa)</button>
          </div>
        </div>

      </div>
    </div>

    {{!-- Aba Habilidades --}}
    <div class="tab" data-group="primary" data-tab="habilidades">
      <div class="habilidades-content">
        <div class="item-controls">
          <button type="button" class="item-create" data-type="habilidade">
            <i class="fas fa-plus"></i> Adicionar Habilidade
          </button>
        </div>

        {{#each habilidadesPorCategoria as |lista categoria|}}
        <div class="habilidades-categoria">
          <h3>{{localize (concat 'HABILIDADES.CATEGORIAS.' (uppercase categoria))}}</h3>
          <ol class="items-list">
            {{#each lista}}
            <li class="item" data-item-id="{{_id}}">
              <div class="item-name">
                <img src="{{img}}" title="{{name}}" width="24" height="24"/>
                <h4>{{name}}</h4>
              </div>
              <div class="item-controls">
                {{#if system.pode_usar}}
                <a class="item-control usar-habilidade" title="Usar Habilidade"><i class="fas fa-fist-raised"></i></a>
                {{/if}}
                <a class="item-control item-edit" title="Editar"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="Excluir"><i class="fas fa-trash"></i></a>
              </div>
            </li>
            {{/each}}
          </ol>
        </div>
        {{/each}}
      </div>
    </div>

    {{!-- Aba Magias --}}
    <div class="tab" data-group="primary" data-tab="magias">
      <div class="magias-content">
        <div class="item-controls">
          <button type="button" class="item-create" data-type="magia">
            <i class="fas fa-plus"></i> Adicionar Magia
          </button>
        </div>

        {{#each magiasPorEscola as |lista escola|}}
        {{#if lista.length}}
        <div class="magias-escola">
          <h3>{{localize (concat 'MAGIAS.ESCOLAS.' (uppercase escola))}}</h3>
          <ol class="items-list">
            {{#each lista}}
            <li class="item" data-item-id="{{_id}}">
              <div class="item-image">
                <img src="{{img}}" title="{{name}}" width="36" height="36"/>
              </div>
              <div class="item-name">
                <h4>{{name}}</h4>
                <span class="item-details">Nível {{system.nivel}} • {{system.custo_pm}} PM</span>
              </div>
              <div class="item-controls">
                {{#if system.pode_conjurar}}
                <a class="item-control conjurar-magia" title="Conjurar Magia"><i class="fas fa-magic"></i></a>
                {{else}}
                <a class="item-control disabled" title="PM Insuficiente"><i class="fas fa-ban"></i></a>
                {{/if}}
                <a class="item-control item-edit" title="Editar"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="Excluir"><i class="fas fa-trash"></i></a>
              </div>
            </li>
            {{/each}}
          </ol>
        </div>
        {{/if}}
        {{/each}}
      </div>
    </div>

    {{!-- Aba Equipamentos --}}
    <div class="tab" data-group="primary" data-tab="equipamentos">
      <div class="equipamentos-content">
        
        {{!-- Equipados --}}
        <div class="equipados-section">
          <h3>Equipamentos Equipados</h3>
          <div class="equipados-grid">
            <div class="slot arma-principal">
              <label>Arma Principal:</label>
              {{#if equipados.arma_principal}}
              <div class="item equipado" data-item-id="{{equipados.arma_principal._id}}">
                <img src="{{equipados.arma_principal.img}}" width="32" height="32"/>
                <span>{{equipados.arma_principal.name}}</span>
                <a class="atacar" title="Atacar"><i class="fas fa-sword"></i></a>
              </div>
              {{else}}
              <div class="slot-vazio">Vazio</div>
              {{/if}}
            </div>

            <div class="slot armadura">
              <label>Armadura:</label>
              {{#if equipados.armadura}}
              <div class="item equipado" data-item-id="{{equipados.armadura._id}}">
                <img src="{{equipados.armadura.img}}" width="32" height="32"/>
                <span>{{equipados.armadura.name}}</span>
              </div>
              {{else}}
              <div class="slot-vazio">Vazio</div>
              {{/if}}
            </div>

            <div class="slot escudo">
              <label>Escudo:</label>
              {{#if equipados.escudo}}
              <div class="item equipado" data-item-id="{{equipados.escudo._id}}">
                <img src="{{equipados.escudo.img}}" width="32" height="32"/>
                <span>{{equipados.escudo.name}}</span>
              </div>
              {{else}}
              <div class="slot-vazio">Vazio</div>
              {{/if}}
            </div>
          </div>
        </div>

        {{!-- Inventário --}}
        <div class="inventario-section">
          <div class="inventario-header">
            <h3>Inventário</h3>
            <div class="peso-info">
              <span class="peso {{#if sobrecarregado}}sobrecarregado{{/if}}">
                {{pesoTotal}}kg / {{capacidadeCarga}}kg
              </span>
            </div>
          </div>

          {{!-- Controles de Criação de Itens --}}
          <div class="item-controls">
            <button type="button" class="item-create" data-type="arma">+ Arma</button>
            <button type="button" class="item-create" data-type="armadura">+ Armadura</button>
            <button type="button" class="item-create" data-type="equipamento">+ Equipamento</button>
            <button type="button" class="item-create" data-type="consumivel">+ Consumível</button>
          </div>

          {{!-- Lista de Itens por Categoria --}}
          {{#each items as |lista categoria|}}
          {{#if lista.length}}
          <div class="items-categoria">
            <h4>{{localize (concat 'EQUIPAMENTOS.' (uppercase categoria))}}</h4>
            <ol class="items-list">
              {{#each lista}}
              <li class="item" data-item-id="{{_id}}" data-tooltip="true">
                <div class="item-image">
                  <img src="{{img}}" title="{{name}}" width="24" height="24"/>
                </div>
                <div class="item-name">
                  <h4>{{name}}</h4>
                  {{#if system.quantidade}}
                  <span class="item-qty">x{{system.quantidade}}</span>
                  {{/if}}
                </div>
                <div class="item-properties">
                  {{#if system.equipado}}
                  <span class="property equipado">Equipado</span>
                  {{/if}}
                  {{#if system.peso}}
                  <span class="property peso">{{system.peso}}kg</span>
                  {{/if}}
                </div>
                <div class="item-controls">
                  {{#if (eq @root.items.armas this)}}
                  <a class="item-control atacar" title="Atacar"><i class="fas fa-sword"></i></a>
                  {{/if}}
                  {{#if (eq @root.items.consumiveis this)}}
                  <a class="item-control usar-item" title="Usar"><i class="fas fa-flask"></i></a>
                  {{/if}}
                  {{#if system.equipado}}
                  <a class="item-control desequipar-item" title="Desequipar"><i class="fas fa-times"></i></a>
                  {{else}}
                  <a class="item-control equipar-item" title="Equipar"><i class="fas fa-check"></i></a>
                  {{/if}}
                  <a class="item-control item-edit" title="Editar"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Excluir"><i class="fas fa-trash"></i></a>
                </div>
              </li>
              {{/each}}
            </ol>
          </div>
          {{/if}}
          {{/each}}
        </div>

        {{!-- Dinheiro --}}
        <div class="dinheiro-section">
          <h3>Dinheiro</h3>
          <div class="moedas-grid">
            <div class="moeda">
              <label>{{localize 'EQUIPAMENTOS.MOEDAS_OURO'}}:</label>
              <input type="number" name="system.equipamentos.dinheiro.moedas_ouro" value="{{system.equipamentos.dinheiro.moedas_ouro}}" min="0"/>
            </div>
            <div class="moeda">
              <label>{{localize 'EQUIPAMENTOS.MOEDAS_PRATA'}}:</label>
              <input type="number" name="system.equipamentos.dinheiro.moedas_prata" value="{{system.equipamentos.dinheiro.moedas_prata}}" min="0"/>
            </div>
            <div class="moeda">
              <label>{{localize 'EQUIPAMENTOS.MOEDAS_COBRE'}}:</label>
              <input type="number" name="system.equipamentos.dinheiro.moedas_cobre" value="{{system.equipamentos.dinheiro.moedas_cobre}}" min="0"/>
            </div>
          </div>
        </div>

      </div>
    </div>

    {{!-- Aba Detalhes --}}
    <div class="tab" data-group="primary" data-tab="detalhes">
      <div class="detalhes-content">
        
        <div class="form-group">
          <label>{{localize 'FICHA.BIOGRAFIA'}}:</label>
          <textarea name="system.detalhes.biografia" rows="4">{{system.detalhes.biografia}}</textarea>
        </div>

        <div class="form-group">
          <label>{{localize 'FICHA.APARENCIA'}}:</label>
          <textarea name="system.detalhes.aparencia" rows="3">{{system.detalhes.aparencia}}</textarea>
        </div>

        <div class="form-group">
          <label>{{localize 'FICHA.PERSONALIDADE'}}:</label>
          <textarea name="system.detalhes.personalidade" rows="3">{{system.detalhes.personalidade}}</textarea>
        </div>

        <div class="form-group">
          <label>{{localize 'FICHA.HISTORIA'}}:</label>
          <textarea name="system.detalhes.historia" rows="5">{{system.detalhes.historia}}</textarea>
        </div>

        <div class="form-group">
          <label>{{localize 'FICHA.MOTIVACOES'}}:</label>
          <textarea name="system.detalhes.motivacoes" rows="3">{{system.detalhes.motivacoes}}</textarea>
        </div>

        <div class="form-group">
          <label>{{localize 'FICHA.NOTAS'}}:</label>
          <textarea name="system.detalhes.notas" rows="4">{{system.detalhes.notas}}</textarea>
        </div>

      </div>
    </div>

  </section>
</form> 