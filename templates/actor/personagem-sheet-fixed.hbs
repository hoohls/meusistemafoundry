<form class="{{cssClass}}" autocomplete="off">
  {{!-- Header da Ficha --}}
  <header class="sheet-header">
    <div class="header-content">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100"/>
      
      <div class="header-fields">
        <div class="name-group">
          <input name="name" type="text" value="{{actor.name}}" placeholder="Nome do Personagem"/>
          <div class="level-xp">
            <label>Nível: <span class="nivel">{{system.nivel}}</span></label>
            <div class="xp-bar">
              <div class="xp-progress" style="width: 0%"></div>
              <span class="xp-text">{{system.experiencia.atual}} / 10 XP</span>
            </div>
          </div>
        </div>

        <div class="identity-group">
          <div class="form-group">
            <label>Raça:</label>
            <select name="system.raca.nome">
              <option value="">Selecione...</option>
              <option value="humano" {{#if (eq system.raca.nome "humano")}}selected{{/if}}>Humano</option>
              <option value="elfo" {{#if (eq system.raca.nome "elfo")}}selected{{/if}}>Elfo</option>
              <option value="anao" {{#if (eq system.raca.nome "anao")}}selected{{/if}}>Anão</option>
              <option value="halfling" {{#if (eq system.raca.nome "halfling")}}selected{{/if}}>Halfling</option>
              <option value="tiefling" {{#if (eq system.raca.nome "tiefling")}}selected{{/if}}>Tiefling</option>
              <option value="goblin" {{#if (eq system.raca.nome "goblin")}}selected{{/if}}>Goblin</option>
            </select>
          </div>

          <div class="form-group">
            <label>Classe:</label>
            <select name="system.classe.nome">
              <option value="">Selecione...</option>
              <option value="guerreiro" {{#if (eq system.classe.nome "guerreiro")}}selected{{/if}}>Guerreiro</option>
              <option value="mago" {{#if (eq system.classe.nome "mago")}}selected{{/if}}>Mago</option>
              <option value="ladino" {{#if (eq system.classe.nome "ladino")}}selected{{/if}}>Ladino</option>
              <option value="diplomata" {{#if (eq system.classe.nome "diplomata")}}selected{{/if}}>Diplomata</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </header>

  {{!-- Abas de Navegação --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="principal">Principal</a>
    <a class="item" data-tab="equipamentos">Equipamentos</a>
    <a class="item" data-tab="detalhes">Detalhes</a>
  </nav>

  {{!-- Conteúdo das Abas --}}
  <section class="sheet-body">
    
    {{!-- Aba Principal --}}
    <div class="tab" data-group="primary" data-tab="principal">
      <div class="principal-content">
        
        {{!-- Atributos --}}
        <div class="atributos-section">
          <h3>Atributos</h3>
          <div class="atributos-grid">
            <div class="atributo">
              <label>Físico</label>
              <div class="atributo-value">
                <input type="number" name="system.atributos.fisico.valor" value="{{system.atributos.fisico.valor}}" min="3" max="18"/>
                <button type="button" class="rolar-atributo" data-atributo="fisico" data-nd="9" title="Rolar teste">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </div>
            </div>
            <div class="atributo">
              <label>Ação</label>
              <div class="atributo-value">
                <input type="number" name="system.atributos.acao.valor" value="{{system.atributos.acao.valor}}" min="3" max="18"/>
                <button type="button" class="rolar-atributo" data-atributo="acao" data-nd="9" title="Rolar teste">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </div>
            </div>
            <div class="atributo">
              <label>Mental</label>
              <div class="atributo-value">
                <input type="number" name="system.atributos.mental.valor" value="{{system.atributos.mental.valor}}" min="3" max="18"/>
                <button type="button" class="rolar-atributo" data-atributo="mental" data-nd="9" title="Rolar teste">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </div>
            </div>
            <div class="atributo">
              <label>Social</label>
              <div class="atributo-value">
                <input type="number" name="system.atributos.social.valor" value="{{system.atributos.social.valor}}" min="3" max="18"/>
                <button type="button" class="rolar-atributo" data-atributo="social" data-nd="9" title="Rolar teste">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        {{!-- Recursos --}}
        <div class="recursos-section">
          <h3>Recursos</h3>
          <div class="recursos-grid">
            
            {{!-- Pontos de Vida --}}
            <div class="recurso pv">
              <label>Pontos de Vida</label>
              <div class="recurso-bar">
                <div class="bar-background">
                  <div class="bar-fill pv-fill" style="width: {{#if system.recursos.pv.max}}{{math system.recursos.pv.valor '/' system.recursos.pv.max '*' 100}}{{else}}0{{/if}}%"></div>
                  <span class="bar-text">{{system.recursos.pv.valor}} / {{system.recursos.pv.max}}</span>
                </div>
                <div class="recurso-controls">
                  <button type="button" class="ajustar-pv" data-operacao="remover" title="Reduzir PV">-</button>
                  <button type="button" class="ajustar-pv" data-operacao="adicionar" title="Aumentar PV">+</button>
                </div>
              </div>
            </div>

            {{!-- Pontos de Magia --}}
            <div class="recurso pm">
              <label>Pontos de Magia</label>
              <div class="recurso-bar">
                <div class="bar-background">
                  <div class="bar-fill pm-fill" style="width: {{#if system.recursos.pm.max}}{{math system.recursos.pm.valor '/' system.recursos.pm.max '*' 100}}{{else}}0{{/if}}%"></div>
                  <span class="bar-text">{{system.recursos.pm.valor}} / {{system.recursos.pm.max}}</span>
                </div>
                <div class="recurso-controls">
                  <button type="button" class="ajustar-pm" data-operacao="remover" title="Reduzir PM">-</button>
                  <button type="button" class="ajustar-pm" data-operacao="adicionar" title="Aumentar PM">+</button>
                </div>
              </div>
            </div>

            {{!-- Defesa --}}
            <div class="recurso defesa">
              <label>Defesa</label>
              <div class="defesa-value">
                <span class="defesa-total">{{system.recursos.defesa.valor}}</span>
                <small class="defesa-breakdown">(10 + {{system.atributos.acao.valor}} + modificadores)</small>
              </div>
            </div>
          </div>
        </div>

        {{!-- Condições Básicas --}}
        <div class="condicoes-section">
          <h3>Condições</h3>
          <div class="condicoes-grid">
            <div class="condicao">
              <input type="checkbox" name="system.condicoes.ferido" {{#if system.condicoes.ferido}}checked{{/if}}/>
              <label>Ferido</label>
            </div>
            <div class="condicao">
              <input type="checkbox" name="system.condicoes.gravemente_ferido" {{#if system.condicoes.gravemente_ferido}}checked{{/if}}/>
              <label>Gravemente Ferido</label>
            </div>
            <div class="condicao">
              <input type="checkbox" name="system.condicoes.inconsciente" {{#if system.condicoes.inconsciente}}checked{{/if}}/>
              <label>Inconsciente</label>
            </div>
          </div>
        </div>

      </div>
    </div>

    {{!-- Aba Equipamentos --}}
    <div class="tab" data-group="primary" data-tab="equipamentos">
      <div class="equipamentos-content">
        
        {{!-- Equipados --}}
        <div class="equipados-section">
          <h3>Equipamentos Equipados</h3>
          <div class="equipados-grid">
            <div class="slot arma-principal">
              <label>Arma Principal:</label>
              {{#if equipados.arma_principal}}
              <div class="item equipado" data-item-id="{{equipados.arma_principal._id}}">
                <img src="{{equipados.arma_principal.img}}" width="32" height="32"/>
                <span>{{equipados.arma_principal.name}}</span>
                <a class="atacar" title="Atacar"><i class="fas fa-sword"></i></a>
              </div>
              {{else}}
              <div class="slot-vazio">Vazio</div>
              {{/if}}
            </div>

            <div class="slot armadura">
              <label>Armadura:</label>
              {{#if equipados.armadura}}
              <div class="item equipado" data-item-id="{{equipados.armadura._id}}">
                <img src="{{equipados.armadura.img}}" width="32" height="32"/>
                <span>{{equipados.armadura.name}}</span>
              </div>
              {{else}}
              <div class="slot-vazio">Vazio</div>
              {{/if}}
            </div>

            <div class="slot escudo">
              <label>Escudo:</label>
              {{#if equipados.escudo}}
              <div class="item equipado" data-item-id="{{equipados.escudo._id}}">
                <img src="{{equipados.escudo.img}}" width="32" height="32"/>
                <span>{{equipados.escudo.name}}</span>
              </div>
              {{else}}
              <div class="slot-vazio">Vazio</div>
              {{/if}}
            </div>
          </div>
        </div>

        {{!-- Inventário --}}
        <div class="inventario-section">
          <div class="inventario-header">
            <h3>Inventário</h3>
            <div class="peso-info">
              <span class="peso {{#if sobrecarregado}}sobrecarregado{{/if}}">
                {{pesoTotal}}kg / {{capacidadeCarga}}kg
              </span>
            </div>
          </div>

          {{!-- Controles de Criação de Itens --}}
          <div class="item-controls">
            <button type="button" class="item-create" data-type="arma">+ Arma</button>
            <button type="button" class="item-create" data-type="armadura">+ Armadura</button>
            <button type="button" class="item-create" data-type="equipamento">+ Equipamento</button>
            <button type="button" class="item-create" data-type="consumivel">+ Consumível</button>
            <button type="button" class="adicionar-item">+ Item Simples</button>
          </div>

          {{!-- Lista de Itens por Categoria --}}
          {{#each items as |lista categoria|}}
          {{#if lista.length}}
          <div class="items-categoria">
            <h4>{{categoria}}</h4>
            <ol class="items-list">
              {{#each lista}}
              <li class="item" data-item-id="{{_id}}" data-tooltip="true">
                <div class="item-image">
                  <img src="{{img}}" title="{{name}}" width="24" height="24"/>
                </div>
                <div class="item-name">
                  <h4>{{name}}</h4>
                  {{#if system.quantidade}}
                  <span class="item-qty">x{{system.quantidade}}</span>
                  {{/if}}
                </div>
                <div class="item-properties">
                  {{#if system.equipado}}
                  <span class="property equipado">Equipado</span>
                  {{/if}}
                  {{#if system.peso}}
                  <span class="property peso">{{system.peso}}kg</span>
                  {{/if}}
                </div>
                <div class="item-controls">
                  {{#if (eq categoria "armas")}}
                  <a class="item-control atacar" title="Atacar"><i class="fas fa-sword"></i></a>
                  {{/if}}
                  {{#if (eq categoria "consumiveis")}}
                  <a class="item-control usar-item" title="Usar"><i class="fas fa-flask"></i></a>
                  {{/if}}
                  {{#if system.equipado}}
                  <a class="item-control desequipar-item" title="Desequipar"><i class="fas fa-times"></i></a>
                  {{else}}
                  <a class="item-control equipar-item" title="Equipar"><i class="fas fa-check"></i></a>
                  {{/if}}
                  {{#if isSimple}}
                  <a class="item-control editar-item-simples" data-index="{{simpleIndex}}" title="Editar"><i class="fas fa-edit"></i></a>
                  <a class="item-control remover-item" data-index="{{simpleIndex}}" title="Remover"><i class="fas fa-trash"></i></a>
                  {{else}}
                  <a class="item-control item-edit" title="Editar"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Excluir"><i class="fas fa-trash"></i></a>
                  {{/if}}
                </div>
              </li>
              {{/each}}
            </ol>
          </div>
          {{/if}}
          {{/each}}
        </div>

        {{!-- Dinheiro --}}
        <div class="dinheiro-section">
          <h3>Dinheiro</h3>
          <div class="moedas-grid">
            <div class="moeda">
              <label>Ouro:</label>
              <input type="number" name="system.equipamentos.dinheiro.ouro" value="{{#if system.equipamentos.dinheiro.ouro}}{{system.equipamentos.dinheiro.ouro}}{{else}}0{{/if}}" min="0"/>
            </div>
            <div class="moeda">
              <label>Prata:</label>
              <input type="number" name="system.equipamentos.dinheiro.prata" value="{{#if system.equipamentos.dinheiro.prata}}{{system.equipamentos.dinheiro.prata}}{{else}}0{{/if}}" min="0"/>
            </div>
            <div class="moeda">
              <label>Cobre:</label>
              <input type="number" name="system.equipamentos.dinheiro.cobre" value="{{#if system.equipamentos.dinheiro.cobre}}{{system.equipamentos.dinheiro.cobre}}{{else}}0{{/if}}" min="0"/>
            </div>
          </div>
        </div>

      </div>
    </div>

    {{!-- Aba Detalhes --}}
    <div class="tab" data-group="primary" data-tab="detalhes">
      <div class="detalhes-content">
        
        <div class="form-group">
          <label>Biografia:</label>
          <textarea name="system.detalhes.biografia" rows="4">{{system.detalhes.biografia}}</textarea>
        </div>

        <div class="form-group">
          <label>Aparência:</label>
          <textarea name="system.detalhes.aparencia" rows="3">{{system.detalhes.aparencia}}</textarea>
        </div>

        <div class="form-group">
          <label>Personalidade:</label>
          <textarea name="system.detalhes.personalidade" rows="3">{{system.detalhes.personalidade}}</textarea>
        </div>

        <div class="form-group">
          <label>História:</label>
          <textarea name="system.detalhes.historia" rows="5">{{system.detalhes.historia}}</textarea>
        </div>

      </div>
    </div>

  </section>
</form> 